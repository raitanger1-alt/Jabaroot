import express from "express";
import fetch from "node-fetch";

const app = express();
app.use(express.json());

const TOKEN = "PUT_YOUR_BOT_TOKEN_HERE";
const TG = `https://api.telegram.org/bot${TOKEN}`;

const memory = {};

function think(user, text){
  if(!memory[user]) memory[user] = [];
  memory[user].push(text);
  if(memory[user].length > 5) memory[user].shift();

  const t = text.toLowerCase();

  if(t.includes("Ø³Ù„Ø§Ù…")) return "ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù… ğŸ‘‹";
  if(t.includes("Ø§Ø³Ù…Ùƒ")) return "Jabaroot AI ğŸ¤–";
  if(t.includes("ÙƒÙŠÙÙƒ")) return "ØªÙ…Ø§Ù… Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ â¤ï¸";
  if(t.includes("help")) return "Ø§ÙƒØªØ¨ Ø§Ù„Ù„ÙŠ ÙÙŠ Ø¨Ø§Ù„Ùƒ.";

  return "ÙØ§Ù‡Ù…Ùƒ ğŸ‘ ÙƒÙ…Ù„.";
}

app.post("/", async (req,res)=>{
  const msg = req.body.message;
  if(!msg) return res.send("ok");

  const chat = msg.chat.id;
  const text = msg.text || "";

  const reply = think(chat, text);

  await fetch(`${TG}/sendMessage`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ chat_id: chat, text: reply })
  });

  res.send("ok");
});

app.post("/web", (req,res)=>{
  const { user, text } = req.body;
  const reply = think(user, text);
  res.json({ reply });
});

app.listen(3000);
